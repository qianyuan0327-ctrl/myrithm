<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timetable</title>
    <style>
      body {
        margin : 0;
        font-family: Arial, sans-serif;
        background-color: #e6e6fa;
      }
      h1 {
        text-align: center;
        padding: 20px;
      }
      #timetable {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        grid-template-rows: repeat(6, 100px);
        gap: 5px;
        width: 90%;
        margin: 0 auto;
      }
      .timetable-cell {
        background-color: white;
        border: 1px solid #ccc;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      #overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      
      #modal {
        background-color: #ff;
        padding: 20px;
        border-radius: 8px;
        width: 300px;
        max-width: 90%;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        transform: scale(0.8);   /* start smaller for animation */
        opacity: 0;              /* invisible initially */
        transition: all 0.3s ease; /* smooth grow/fade animation */
      }
    </style>
  </head>
  <body>
    <div id="admin-login" style="margin-bottom:20px;">
    <input id="adminEmail" placeholder="Email">
    <input id="adminPass" type="password" placeholder="Password">
    <button id="LoginBtn">Login</button>
    <button id="LogoutBtn" style="display:none;">Logout</button>
    </div>
    <h1>Timetabel</h1>
    <div style="text-align:center; margin-bottom:10px;">
      <button id="weekA">Week A</button>
      <button id="weekB">Week B</button>
      <span id="weekLabel">Week A</span>
    </div>
    <div id="timetable"></div>
    <div id="overlay" style="display:none;">
      <div id="modal" style="background:white; padding:20px; border-radius:8px; width:300px; max-width:90%;">
        <h2 id="modalTitle"></h2>
        <textarea id="taskText" placeholder="Task here"></textarea>
        <label>Due:</label>
        <input type="date" id="dueDate">
        <div class="modal-buttons">
          <button id="saveBtn">Save</button>
          <button id="deleteBtn">Delete</button>
          <button id="closeBtn">Cancel</button>
        </div>
      </div>
    </div>
    <script type="module">
    import { initializeApp } 
    from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } 
    from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, deleteDoc } 
    from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
      
    const firebaseConfig = {
      apiKey: "AIzaSyCGdF9m5jAC_PV7ainjGr2vsRvxRSuHRgE",
      authDomain: "myrithm-storage.firebaseapp.com",
      projectId: "myrithm-storage",
      storageBucket: "myrithm-storage.firebasestorage.app",
      messagingSenderId: "1069448713700",
      appId: "1:1069448713700:web:248cd3e46328c2a89823f1",
      measurementId: "G-37Y5JS94HH"
    };
      
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    
    document.getElementById("LoginBtn").onclick = async () => {
      const email = document.getElementById("adminEmail").value;
      const pass = document.getElementById("adminPass").value;
      try {
        await signInWithEmailAndPassword(auth, email, pass);
      } catch (e) {
        alert("Login failed");
      }
    };
      
    onAuthStateChanged(auth, (user) => {
      if (user) {
        console.log("Admin logged in:", user.uid);
        document.getElementById("LoginBtn").style.display = "none";
        document.getElementById("LogoutBtn").style.display = "inline-block";
      } else {
        document.getElementById("LoginBtn").style.display = "inline-block";
        document.getElementById("LogoutBtn").style.display = "none";
      }
    });


    document.getElementById("LogoutBtn").onclick = async () => {
      await signOut(auth);
    };
    let currentWeek = "A";
    document.getElementById("weekA").onclick = () => {
      currentWeek = "A";
      document.getElementById("weekLabel").textContent = "Week A";
      renderTimetable();
    };

    document.getElementById("weekB").onclick = () => {
      currentWeek = "B";
      document.getElementById("weekLabel").textContent = "Week B";
      renderTimetable();
    };
    function renderTimetable() {
      const container = document.getElementById("timetable");
      container.innerHTML = "";
      timetableData[currentWeek].forEach((row, rowIndex) => {
        row.forEach((subject, colIndex) => {
          const cell = document.createElement("div");
          cell.className = "timetable-cell";
          cell.textContent = subject;
          container.appendChild(cell);
    
          cell.addEventListener("click", () => openPopup(subject, rowIndex, colIndex));
        });
      });
    }
    function openPopup(subject, rowIndex, colIndex) {
      const overlay = document.getElementById("overlay");
      const modal = document.getElementById("modal");
    
      overlay.style.display = "flex";
      modal.style.transform = "scale(0.8)";
      modal.style.opacity = 0;
      modal.offsetHeight;
      modal.style.transform = "scale(1)";
      modal.style.opacity = 1;
    
      document.getElementById("modalTitle").textContent = subject;
      const docId = `${currentWeek}-${rowIndex}-${colIndex}-${roomData[currentWeek][rowIndex][colIndex]}`;
      const docRef = doc(db, "timetable", docId);
    
      // Fetch task
      getDoc(docRef).then(docSnap => {
        document.getElementById("taskText").value = docSnap.exists() ? docSnap.data().task : '';
        document.getElementById("dueDate").value = docSnap.exists() ? docSnap.data().dueDate : '';
      });
    
      // Remove old listeners and add new ones
      const saveBtn = document.getElementById("saveBtn");
      const deleteBtn = document.getElementById("deleteBtn");
      const closeBtn = document.getElementById("closeBtn");
    
      saveBtn.replaceWith(saveBtn.cloneNode(true));
      deleteBtn.replaceWith(deleteBtn.cloneNode(true));
      closeBtn.replaceWith(closeBtn.cloneNode(true));
    
      document.getElementById("saveBtn").addEventListener("click", async () => {
        await setDoc(docRef, { subject, task: document.getElementById("taskText").value, dueDate: document.getElementById("dueDate").value });
        overlay.style.display = "none";
      });
    
      document.getElementById("deleteBtn").addEventListener("click", async () => {
        await deleteDoc(docRef);
        document.getElementById("taskText").value = "";
        document.getElementById("dueDate").value = "";
        overlay.style.display = "none";
      });
    
      document.getElementById("closeBtn").addEventListener("click", () => overlay.style.display = "none");
    }
    const timetableData = {
      A: [
        ["Chinese", "History", "History", "Physics", "French"],
        ["French", "English", "English", "Guidance", "History"],
        ["French", "Physical Education", "English", "Physical Education", "Computer Science"],
        ["Chemistry", "Biology", "Mathematics", "Chinese", "Mathematics"],
        ["English", "French", "Computer Science", "Computer Science", "English"],
        ["Biology", "Mathematics", "Chinese", "English", "Physics"]
      ],
      B: [
        ["Physics", "Mathematics", "History", "Physics", "History"],
        ["English", "Chinese", "French", "Guidance", "English"],
        ["Mathematics", "Physical Education", "Computer Science", "Physical Education", "Mathematics"],
        ["Biology", "History", "English", "English", "Chinese"],
        ["French", "Mathematics", "Mathematics", "Chinese", "Chemistry"],
        ["Computer Science", "Computer Science", "Chemistry", "Chemistry", "Biology"]
      ]
    };
    
    const roomData = {
      A: [
        ["E1", "Z1", "Z1", "C4", "F5"],
        ["F5", "B9", "B9", "C10", "Z1"],
        ["F5", "PE", "B9", "PE", "A14"],
        ["C18", "C6", "C10", "E1", "C10"],
        ["B9", "F5", "A14", "A14", "B9"],
        ["Z4", "C10", "E1", "B9", "C4"]
      ],
      B: [
        ["C4", "C10", "Z1", "Z3", "Z1"],
        ["B9", "E1", "F5", "C10", "B9"],
        ["C10", "PE", "A14", "PE", "C10"],
        ["C19", "Z1", "B9", "B9", "T4"],
        ["F5", "C10", "C10", "E1", "C6"],
        ["A14", "A14", "C18", "C18", "C18"]
      ]
    };
    renderTimetable();
  </script>
    
    
  </body>
  
</html>
