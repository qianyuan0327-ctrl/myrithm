<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timetable</title>
    <style>
      body {
        margin : 0;
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
      }
      h1 {
        text-align: center;
        padding: 20px;
      }
      #timetable {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        grid-template-rows: repeat(6, 100px);
        gap: 5px;
        width: 90%;
        margin: 0 auto;
      }
      .timetable-cell {
        background-color: white;
        border: 1px solid #ccc;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }
    </style>
  </head>
  <body>
    <div id="admin-login" style="margin-bottom:20px;">
    <input id="adminEmail" placeholder="Email">
    <input id="adminPass" type="password" placeholder="Password">
    <button id="LoginBtn">Login</button>
    <button id="LogoutBtn" style="display:none;">Logout</button>
    </div>
    <h1>Timetabel</h1>
    <div style="text-align:center; margin-bottom:10px;">
      <span id="weekLabel">Week A</span>
    </div>
    <div id="timetable"></div>
    <div id="overlay" style="display:none;">
      <div id="modal" style="background:white; padding:20px; border-radius:8px; width:300px; max-width:90%;">
        <h2 id="modalTitle"></h2>
        <textarea id="taskText" placeholder="Task here"></textarea>
        <label>Due:</label>
        <input type="date" id="dueDate">
        <div class="modal-buttons">
          <button id="saveBtn">Save</button>
          <button id="deleteBtn">Delete</button>
          <button id="closeBtn">Cancel</button>
        </div>
      </div>
    </div>
    <script type="module">
    import { initializeApp } 
    from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } 
    from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, deleteDoc } 
    from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
      
    const firebaseConfig = {
      apiKey: "AIzaSyCGdF9m5jAC_PV7ainjGr2vsRvxRSuHRgE",
      authDomain: "myrithm-storage.firebaseapp.com",
      projectId: "myrithm-storage",
      storageBucket: "myrithm-storage.firebasestorage.app",
      messagingSenderId: "1069448713700",
      appId: "1:1069448713700:web:248cd3e46328c2a89823f1",
      measurementId: "G-37Y5JS94HH"
    };
      
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    
      document.getElementById("LoginBtn").onclick = async () => {
      const email = document.getElementById("adminEmail").value;
      const pass = document.getElementById("adminPass").value;
      try {
        await signInWithEmailAndPassword(auth, email, pass);
      } catch (e) {
        alert("Login failed");
      }
    };
      
    onAuthStateChanged(auth, (user) => {
      if (user) {
        console.log("Admin logged in:", user.uid);
        document.getElementById("LoginBtn").style.display = "none";
        document.getElementById("LogoutBtn").style.display = "inline-block";
      } else {
        document.getElementById("LoginBtn").style.display = "inline-block";
        document.getElementById("LogoutBtn").style.display = "none";
      }
    });

    document.getElementById("LogoutBtn").onclick = async () => {
      await signOut(auth);
    };
    let currentWeek = "A"; // current week A/B

    function renderTimetable() {
      const container = document.getElementById("timetable");
      container.innerHTML = "";
      timetableData[currentWeek].forEach((row, rowIndex) => {
        row.forEach((subject, colIndex) => {
          const cell = document.createElement("div");
          cell.className = "timetable-cell";
          cell.textContent = subject;
          container.appendChild(cell);
    
          cell.addEventListener("click", () => openPopup(subject, rowIndex, colIndex));
        });
      });
    }
    function openPopup(subject, rowIndex, colIndex) {
      const overlay = document.getElementById("overlay");
      overlay.style.display = "flex";
    
      document.getElementById("modalTitle").textContent = subject;
    
      const docId = `${currentWeek}-${rowIndex}-${colIndex}`;
      const docRef = doc(db, "timetable", docId);
    
      getDoc(docRef).then(docSnap => {
        if (docSnap.exists()) {
          document.getElementById("taskText").value = docSnap.data().task;
          document.getElementById("dueDate").value = docSnap.data().dueDate;
        } else {
          document.getElementById("taskText").value = "";
          document.getElementById("dueDate").value = "";
        }
      });
    
      document.getElementById("closeBtn").onclick = () => overlay.style.display = "none";
    
      document.getElementById("saveBtn").onclick = async () => {
        const task = document.getElementById("taskText").value;
        const dueDate = document.getElementById("dueDate").value;
        await setDoc(docRef, { subject, task, dueDate });
        overlay.style.display = "none";
      };
    
      document.getElementById("deleteBtn").onclick = async () => {
        await deleteDoc(docRef);
        document.getElementById("taskText").value = "";
        document.getElementById("dueDate").value = "";
        overlay.style.display = "none";
      };
    }
    
    const timetableData = {
      A: [
        ["Chinese E1", "History Z1", "History Z1", "Physics C4", "French F5"],
        ["French F5", "English B9", "English B9", "Guidance C10", "History Z1"],
        ["French F5", "Physical Education", "English B9", "Physical Education", "Computer Science A14"],
        ["Chemistry C18", "Biology C6", "Mathematics C10", "Chinese E1", "Mathematics C10"],
        ["English B9", "French F5", "Computer Science A14", "Computer Science A14", "English B9"],
        ["Biology Z4", "Mathematics C10", "Chinese E1", "English B9", "Physics C4"]
      ],
      B: [
        ["Physics C4", "Mathematics C10", "History Z1", "Physics Z3", "History Z1"],
        ["English B9", "Chinese E1", "French F5", "Guidance C10", "English B9"],
        ["Mathematics C10", "Physical Education", "Computer Science A14", "Physical Education", "Mathematics C10"],
        ["Biology C19", "History Z1", "English B9", "English B9", "Chinese T4"],
        ["French F5", "Mathematics C10", "Mathematics C10", "Chinese E1", "Chemistry C6"],
        ["Computer Science A14", "Computer Science A14", "Chemistry C18", "Chemistry C18", "Biology C18"]
      ]
    };
    renderTimetable();
  </script>
    
    
  </body>
  
</html>
