<!DOCTYPE html>
<html>
<head>
  <title>Mainspace</title> 
  <style>
  #list {
    height: 300px;
    overflow-y: auto;
    border: 1px solid #ddd; 
    padding: 10px;
    list-style: none;
  }
  </style>
</head>

<body>
  <div style="font-family: sans-serif; margin-bottom: 10px;">
  Total Notes: <span id="counter">0</span>
  </div>
  <h1>Comment board</h1>
  <a href="explain.html" style="color: #007bff; text-decoration: none;">[Why you're here]</a>
  <input id="in" placeholder="New note...">
  <button id="btn">Save</button>
  <ul id="list" style="font-family: monospace;"></ul>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCGdF9m5jAC_PV7ainjGr2vsRvxRSuHRgE",
        authDomain: "myrithm-storage.firebaseapp.com",
        projectId: "myrithm-storage",
        storageBucket: "myrithm-storage.firebasestorage.app",
        messagingSenderId: "1069448713700",
        appId: "1:1069448713700:web:248cd3e46328c2a89823f1",
        measurementId: "G-37Y5JS94HH"
    };

    const db = getFirestore(initializeApp(firebaseConfig));
    const colRef = collection(db, "entries");

    document.getElementById('btn').onclick = async () => {
      const val = document.getElementById('in').value;
      if (val) await addDoc(colRef, { text: val, time: serverTimestamp() });
      document.getElementById('in').value = "";
    };

    const q = query(colRef, orderBy("time", "desc"));
    onSnapshot(q, (snap) => {
      document.getElementById('counter').innerText = snap.size;
      document.getElementById('list').innerHTML = snap.docs.map(doc => {
      const d = doc.data();
      const dateStr = d.time ? d.time.toDate().toLocaleString() : "Saving...";
      return `<li style="margin-bottom: 15px;">[${dateStr}] ${d.text}</li>`;
    }).join("");
    const list = document.getElementById('list');
    list.scrollTop = list.scrollHeight;
});
  </script>
</body>
</html>
